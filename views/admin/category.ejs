<%- include('../adminLayouts/header.ejs') -%>
<style>
    .long-text {
     max-width: 200px;
     text-overflow: ellipsis;
     overflow: hidden;
     white-space: nowrap;
     word-wrap: break-word;
    }
    </style>
 <!-- Container-fluid starts-->
 <div class="page-body">
    <!-- All User Table Start -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="card card-table">
                    <div class="card-body">
                        <div class="title-header option-title">
                            <h5>All Category</h5>
                            <form class="d-inline-flex">
                                <a href="/admin/category/addCategory"
                                    class="align-items-center btn btn-theme d-flex">
                                    <i data-feather="plus-square"></i>Add New
                                </a>
                            </form>
                        </div>

                        <div class="table-responsive category-table">
                            <div>
                                <table class="table all-package theme-table" id="table_id">
                                    <thead>
                                        <tr>
                                            <th>Category Name</th>
                                            <th>Description</th>                                            
                                            <th>List/Unlist</th>                                            
                                            <th>Option</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <% for(let i = 0; i< categories.length; i++) { %>
                                        <tr>
                                            <td><%= categories[i].category %></td>
                                            <td class="long-text"><%= categories[i].description %></td>
                                            <td><% if(categories[i].is_listed==true){ %>
                                 
                                                <button onclick="listUser()" type="button" class="btn btn-success" data-category-id="<%= categories[i]._id %>" data-is-listed=false>
                                                  Unlist
                                                </button>
                                                <% }else{ %>
                                                <button onclick="listUser()" type="button" class="btn btn-danger" class="btn toggle-btn" data-category-id="<%= categories[i]._id %>"  data-is-listed=true>
                                                  List
                                                </button>                              
                                                <% } %>
                                            </td>
                                            <td>
                                                <ul>

                                                    <li>
                                                        <a href="/admin/category/editCategory/<%= categories[i]._id %>">
                                                            <i class="ri-pencil-line"></i>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                        <% }; %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- All User Table Ends-->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        async function listUser() {
          var button = event.target;
    
          var categoryId = button.dataset.categoryId
          var isListed = button.dataset.isListed;
          console.log("category ID: ", categoryId);
          console.log("Is Listed: ", isListed);
    
          $.ajax({
            type: 'POST',
            data: {
              categoryId: categoryId,
              isListed: isListed
            },
            url: '/admin/category/categoryToggleList',
            success: async (res) => {
              if (res.success) {
                displayMessage(isListed);
              } else {
                // Handle unsuccessful response
                console.error('Toggle block failed');
              }
            },
            error: (err) => {
              // Handle AJAX error
              console.error('Error in AJAX request:', err);
            }
          });
          function displayMessage(isListed){
            var alertMessage = isListed === 'true'
            ? "ðŸŽ‰ Category listed successfully!"
            : "ðŸš« Category Unlisted successfully!";
                Swal.fire({
                    icon:'success',
                    title: 'Alert meaasge',
                    text: alertMessage,
                    willClose: ()=>{
                        window.location.reload();
                    }
                });
          }
        }
      </script>


<%- include('../adminLayouts/footer.ejs') -%>
